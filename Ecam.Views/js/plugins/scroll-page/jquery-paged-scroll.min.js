(function(c,k,n,p){c.ajax_scroll=function(a,d){this.settings=c.extend({},c.ajax_scroll.defaults,d);this._validate(this.settings);this.timerInterval=-1;this.lastDocHeight=0;this.proccesingCallback=!1;this.lastScrollPosition=0;this.lastHtmlLength=c(this.settings.targetElement).html().length;this.instanceID="paged_scroll"+Math.round(9999999999*Math.random());var l=function(b){return function(){b.settings.useScrollOptimization?-1===b.timerInterval&&(b._debug("Setting timeout:",b.settings.checkScrollChange),
b.timerInterval=setTimeout(function(){b._checkScroll(a,c,k,n,b.settings);b.timerInterval=-1},b.settings.checkScrollChange)):b._checkScroll(a,c,k,n,b.settings)}}(this);c(a).off("scroll").unbind("scroll").on("scroll",l)};c.ajax_scroll.defaults={handleScroll:function(a,d,c){return!0},triggerFromBottom:"10%",loading:{html:'<div style="text-align:center">Loading...</div>'},targetElement:null,startPage:0,pagesToScroll:null,beforePageChanged:function(a,d){return!0},afterPageChanged:function(a,d){return!0},
useScrollOptimization:!0,checkScrollChange:500,monitorChangeInterval:300,monitorTargetChange:!0,debug:!1};c.ajax_scroll.prototype={_calculateStep:function(a){return-1<a.triggerFromBottom.toString().indexOf("%")?parseFloat(a.triggerFromBottom.replace("%","")):parseFloat(a.triggerFromBottom)},_validate:function(a){var d=this._calculateStep(a);if(isNaN(d))throw"Step need to be provided as number or percentage,50 or 5% fro percent for example";if(!a.targetElement||0===c(a.targetElement).length)throw"Please provide the selector of target element.(Element where you finally insert the new content)";
},_checkCallbackDone:function(a,d){this._debug("Checking target html for change...");if(a.monitorTargetChange&&c(a.targetElement).is(":visible")){var l=c(a.targetElement).html().length;if(l!==this.lastHtmlLength)this._debug("Html is changed"),this.lastHtmlLength=l,this.proccesingCallback=!1,c(d).hide();else{var b=this;this._debug("Html is not changed.Check later");setTimeout(function(){b._checkCallbackDone.call(b,b.settings,d)},b.settings.monitorChangeInterval)}}},_getScrollData:function(a,d,c,b,
f,e){var g=parseFloat(a(d).height()),h=parseFloat(a(d).scrollTop());a=(d=d.self===c)?parseFloat(a(b).height()):g;f=a/f._calculateStep(e);return{elemHeight:g,elemScroll:h,isWindow:d,docHeight:a,step:f}},_checkScroll:function(a,d,c,b,f){this._debug("Checking scroll on  : "+this.instanceID);var e=this;if(f.targetElement&&!d(f.targetElement).is(":visible"))e._debug("Ignoring the call because target element is not  visible.Exit scroll check ..");else if(e.proccesingCallback)e._debug("Processing callback.Exit...");
else{var g=e._getScrollData(d,a,c,b,e,f);b=g.elemHeight;var h=g.elemScroll,m=g.isWindow;c=g.docHeight;g=g.step;e._debug(["Elem height : ",b,".Elem scroll :",h,".Step is :",g,".DocHeight :",c,".Last element height:",e.lastDocHeight].join(""));b=m?b+h+g:h+g;e._debug("Position:"+b+".Last position:"+e.lastScrollPosition+".Last element height:"+e.lastDocHeight);h=b>e.lastScrollPosition;m=!f.pagesToScroll||f.pagesToScroll&&f.startPage<f.pagesToScroll;if(b>=c&&h&&m){this.lastScrollPosition=b;this.lastDocHeight=
c;f.startPage+=1;f.beforePageChanged(f.startPage,a);e._debug("Calling 'handleScroll' callback");e.proccesingCallback=!0;var k=d(e.settings.loading.html).appendTo(d(e.settings.targetElement));e.lastHtmlLength=d(f.targetElement).html().length;f.handleScroll(f.startPage,a,function(){e._debug("Callback done.");e.proccesingCallback=!1;k.hide()});e._checkCallbackDone.call(e,e.settings,k);f.afterPageChanged(f.startPage,a)}}},_debug:function(){try{this.settings.debug&&("undefined"!==typeof console&&"function"===
typeof console.log?1===Array.prototype.slice.call(arguments).length&&"string"===typeof Array.prototype.slice.call(arguments)[0]?console.log(Array.prototype.slice.call(arguments).toString()):console.log(Array.prototype.slice.call(arguments)):Function.prototype.bind||"undefined"===typeof console||"object"!==typeof console.log||Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments)))}catch(a){}}};c.fn.paged_scroll=function(a){return this.each(function(){var d=new c.ajax_scroll(this,
a);c.data(this,"jqueryPagedScroll",d)})}})(jQuery,window,document);
