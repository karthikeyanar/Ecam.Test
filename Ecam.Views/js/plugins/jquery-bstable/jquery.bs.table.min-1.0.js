(function(e){var d=function(a,b){this.element=a;this.$element=e(a);this.options=e.extend({},d.DEFAULTS,b);this.applySorting();1==this.options.autoload&&this.refresh()};d.prototype.applySorting=function(){var a=this.options,b=this.element,g=e(b);e("thead",b).find("th").removeClass("sort").removeClass("asc").removeClass("desc").each(function(){var c=e(this),b=c.attr("displayname");void 0==b&&(b=c.html());c.empty();var b=e("<div></div>").html(b),d=c.attr("display-width");void 0!=d&&b.width(d);c.empty().append(b);
g.attr("sortname")==c.attr("sortname")&&c.addClass("sort").addClass(g.attr("sortorder"));""!=c.attr("sortname")&&void 0!=c.attr("sortname")&&c.unbind("click").click(function(){var b=g.attr("sortorder"),b="asc"==b||""==b?"desc":"asc";g.attr("sortorder",b);c.removeClass("sort").removeClass("asc").removeClass("desc").siblings().removeClass("sort").removeClass("asc").removeClass("desc");c.addClass("sort").addClass(b);if(a.onSorting)a.onSorting(c.attr("sortname"),g.attr("sortorder"))})})};d.DEFAULTS={onSort:null,
onBefore:null,onDone:null,onFail:null,onAlways:null,sortName:"",sortOrder:"",pageIndex:0,pageSize:0,params:[],url:"",type:"GET",dataType:"JSON",cache:!1,autoload:!0};d.prototype.sort=function(a,b){this.options.sortName=a;this.options.sortOrder=b;this.options.pageIndex=1;this.refresh()};d.prototype.goTo=function(a){this.options.pageIndex=a;this.refresh()};d.prototype.resetPageIndex=function(){this.options.pageIndex=1};d.prototype.getOptions=function(){return this.options};d.prototype.refresh=function(){var a=
this;a.options.params=[];a.options.onBefore&&(a.options.params=a.options.onBefore());var b="",d=0,c=0,h="",k="",b="function"==e.type(a.options.url)?a.options.url():a.options.url,d="function"==e.type(a.options.pageIndex)?a.options.pageIndex():a.options.pageIndex,c="function"==e.type(a.options.pageSize)?a.options.pageSize():a.options.pageSize,h="sortName"==e.type(a.options.sortName)?a.options.sortName():a.options.sortName,k="sortOrder"==e.type(a.options.sortOrder)?a.options.sortOrder():a.options.sortOrder,
f=a.options.params;f[f.length]={name:"pageindex",value:d};f[f.length]={name:"pagesize",value:c};f[f.length]={name:"sortname",value:h};f[f.length]={name:"sortorder",value:k};a.options.params=f;e.ajax({url:b,cache:a.options.cache,type:a.options.type,dataType:a.options.dataType,data:f}).done(function(b){if(a.options.onDone)a.options.onDone(b)}).fail(function(){if(a.options.onFail)a.options.onFail(data)}).always(function(b){if(a.options.onAlways)a.options.onAlways(b)})};e.fn.bsTable=function(a,b){return this.each(function(){var g=
e(this),c=g.data("bsTable");c||g.data("bsTable",c=new d(this,a));c&&("sort"==a&&c.sort(b.sortName,b.sortOrder),"goto"==a&&c.goTo(b.pageIndex),"refresh"==a&&c.refresh(),"resetPageIndex"==a&&c.resetPageIndex())})}})(jQuery);
